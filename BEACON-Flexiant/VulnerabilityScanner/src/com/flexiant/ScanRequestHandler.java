package com.flexiant;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.net.Socket;
import java.util.HashMap;
import java.util.concurrent.ArrayBlockingQueue;

import org.apache.log4j.LogManager;
import org.apache.log4j.Logger;

/**
 * Class to handle the socket requests. 
 * This class reads from the socket and adds to the queue.
 * @author mramannavar
 *
 */
public class ScanRequestHandler implements Runnable {

	Socket socket = null;
	ArrayBlockingQueue<HashMap<String, String>> queue = null;
	private static Logger LOGGER = LogManager.getLogger(ScanRequestHandler.class);
	
	public ScanRequestHandler(Socket socket, ArrayBlockingQueue<HashMap<String, String>> queue) {
		this.socket = socket;
		this.queue = queue;
	}
	
	@Override
	public void run() {
		try {
			LOGGER.info("Adding a request to the queue...");
			ObjectInputStream ois = new ObjectInputStream(socket.getInputStream());
			HashMap<String, String> map = (HashMap<String, String>) ois.readObject();
	        // The ArrayBlockingQueue is thread safe
			queue.add(map);
		} catch (IOException e) {
			LOGGER.error("Failed to read data from the Socket", e);
		} catch (ClassNotFoundException e) {
			LOGGER.error("Error in converting the data from socket to HashMap", e);
		}      
	}
}
